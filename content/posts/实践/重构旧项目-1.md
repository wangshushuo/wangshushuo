---
author: ç‹ä¹¦ç¡•
date: 2020-04-02T15:17:52+08:00

title: "é‡æ„æ—§é¡¹ç›®-1"
summary: "å°è¯•ä¼˜åŒ–ä¸€ä¸ªæ—§é¡¹ç›®çš„ä»£ç ï¼Œå°†ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­çš„éƒ¨åˆ†ä»£ç å°è£…ä¸ºç»„ä»¶ã€‚å¯ä»¥é™ä½å¤æ‚åº¦ï¼Œæ”¹å–„é˜…è¯»ä»£ç çš„éš¾åº¦ã€‚"
categories:
- æŠ˜è…¾
---

## èƒŒæ™¯
è¿™ä¸ªé¡¹ç›®æœ‰ç‚¹è€æ—§
```
"dva": "2.1.0",
"react": "^16.2.0",
```
æˆ‘æ‰“ç®—ç”¨æœ€æ–°çš„ react å’Œ @reduxjs/toolkit å¼€å§‹é‡æ„ï¼Œæ—§çš„ä¾èµ–åªèƒ½ä½¿ç”¨ connect æ–¹å¼æ¥è·å– store ï¼Œä½¿ç”¨ useSelector å’Œ useDispatch å¾ˆæ–¹ä¾¿ä¹Ÿå¾ˆæ˜“è¯»ã€‚`@reduxjs/toolkit`æä¾›çš„immerå’ŒactionCreaterä¹Ÿå¾ˆå¥½ç”¨ã€‚

æ–°ç‰ˆæœ¬çš„ react-redux æ‰æä¾›äº† useSelector å’Œ useDispatch ï¼Œä½†æ˜¯æ–°ç‰ˆæœ¬ä¼šå¯¼è‡´ dva å‡ºé”™ã€‚æ— å¥ˆæ”¾å¼ƒäº†æ–°ç‰ˆæœ¬ï¼Œè¿˜æ˜¯ç”¨æ—§ç‰ˆæœ¬çš„ connect ã€‚è¿˜å¥½è¿™ä¸å½±å“å¯¹ä»£ç è¿›è¡Œç»„ä»¶åŒ–ã€‚

é¦–å…ˆé‡æ„çš„æ˜¯ä¸€ä¸ª643è¡Œçš„ç»„ä»¶ï¼Œå®ƒçš„renderæ–¹æ³•æœ‰580è¡Œã€‚

## é‡å¤ä»£ç 

å¾ˆå®¹æ˜“çš„å‘ç°äº†ä¸€å¤§æ®µé‡å¤ä»£ç 
```jsx
<div className={styles.numbers_wrapper}>
  <span className={styles.number_item}>
      <span className={styles.number}>{detail.properties.member_count}</span>
      <span className={styles.text}>ç­çº§æ€»äººæ•°</span>
  </span>
  <span className={styles.number_item}>
      <span className={styles.number}>{detail.properties.male_count}</span>
      <span className={styles.text}>ç”·ç”Ÿäººæ•°</span>
  </span>
  <span className={styles.number_item}>
      <span className={styles.number}>{detail.properties.female_count}</span>
      <span className={styles.text}>å¥³ç”Ÿäººæ•°</span>
  </span>
  <span className={styles.number_item}>
      <span className={styles.number}>{detail.properties.group_count &&( detail.properties.group_count[userDetail.detail.id] || 0)}</span>
      <span className={styles.text}>åˆ†ç»„æ•°</span>
  </span>
  <span className={styles.number_item}>
      <span className={styles.number}>{(detail.properties.user_lecture_count ? (detail.properties.user_lecture_count[userDetail.detail.id] || 0) : 0)}</span>
      <span className={styles.text}>æˆè¯¾æ¬¡æ•°</span>
  </span>
</div>
```
å¯ä»¥å°†ä»–ä»¬ç»„ç»‡æˆ2ä¸ªç»„ä»¶
```jsx
function NumberWithLabel({ label, count }) {
    return (
        <span className={styles.number_item}>
            <span className={styles.number}>{count}</span>
            <span className={styles.text}>{label}</span>
        </span>
    );
}
```
```jsx
<div className={styles.numbers_wrapper}>
    <NumberWithLabel label="ç­çº§æ€»äººæ•°" count={member_count} />
    <NumberWithLabel label="ç”·ç”Ÿäººæ•°" count={male_count} />
    <NumberWithLabel label="å¥³ç”Ÿäººæ•°" count={female_count} />
    <NumberWithLabel label="åˆ†ç»„æ•°" count={group_count && (group_count[userId] || 0)} />
    <NumberWithLabel label="æˆè¯¾æ¬¡æ•°" count={(user_lecture_count ? (user_lecture_count[userId] || 0) : 0)} />
</div>
```
æ•°æ®ä½¿ç”¨ connect è·å–ï¼Œè¿™æ ·ä»£ç çœ‹èµ·æ¥ç®€å•è¯»äº†ã€‚

## å°è£…ç»„ä»¶
ç„¶åå‘ç°äº†ä¸€å¤§æ®µä»£ç å¯ä»¥å°è£…æˆä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ã€‚
```jsx
<div className={styles.card_body}>
{
    groupList && groupList.map((group, index) => (
        <div className={styles.group_item} key={index} onDrop={() => handleStudentDrop(group)} onDragOver={handleStudentDragOver}                                                >
            <div className={styles.group_item_header}>
                <span className={styles.group_item_info}>
                    {group.name}
                    <i className={styles.trophy_icon} />
                </span>
                <span className={styles.group_item_btns}>
                </span>
                <Radio className={styles.group_student_list_radio} checked={group.id === curGroup} onClick={() => selectCurGroup(group.id)} />
            </div>
            <div className={styles.group_student_list}>
                {
                    group.members && group.members.length === 0 ? (
                        <div style={{
                            textAlign:'center',
                            fontSize:14,
                            color:'#666',
                        }}>è¯¥å°ç»„æ²¡æœ‰å­¦ç”Ÿ</div>) : (
                        group.members.map((stu, i) => (<StudentItem
                            isDrage
                            key={i}
                            stu={stu}
                            group={group}
                            gender={stu.gender}
                            headimg_res_url={stu.headimg_res_url}
                            name={stu.name}
                            groupStuStyle
                            onDragStart={() => handleDragStart(stu, group.id)}
                            onSetLeader={e => handleSetLeader(e, stu,group)}
                            onSetHeader={e => handleSetHeader(e, stu)}
                        />))
                    )
                }
            </div>
        </div>
    ))
}
</div>
```
è¿˜æœ‰å®ƒç›¸å…³çš„æ–¹æ³•éƒ½æ˜¯åƒä¸‹é¢ğŸ‘‡è¿™æ ·çš„ dispatch ï¼Œå¤§æ¦‚æœ‰äº”å…­ä¸ªã€‚å®ƒä»¬éƒ½å†™åœ¨ render å‡½æ•°å†…ï¼Œå ç”¨äº†å¾ˆå¤§çš„ç¯‡å¹…ï¼Œå¯¹é˜…è¯»ä»£ç æœ‰å¾ˆå¤§çš„å½±å“ã€‚
```js
const handleDragStart = (stu, org_id) => {
    dispatch({
        type: 'classDetail/updateState',
        payload: {
            onDragStudent: {
                ...stu,
                org_id,
                type:!!org_id,
            },
        },
    });
};
```
æˆ‘å°†è¿™ä¸ª `dispatch` ä¸­çš„ `action` æ”¾åˆ°ä¸€ä¸ª `action_creater.js` æ–‡ä»¶ä¸­ï¼Œå°†ç»„å»ºæ”¾åœ¨ `GroupItem.jsx` æ–‡ä»¶ä¸­ã€‚è¿™å¯ä»¥è®©æ¬¡è¦çš„ä¿¡æ¯ä¸å ç”¨ç¯‡å¹…ï¼Œä¸»è¦çš„ä¿¡æ¯å°±ä¼šä¸€ç›®äº†ç„¶äº†ã€‚
è¿™æ®µä»£ç å°±å˜æˆäº†2ä¸ªç»„ä»¶å’Œ1ä¸ª `action creater` æ–‡ä»¶ã€‚ç›¸å…³çš„ä»£ç å°è£…åœ¨ä¸€èµ·ï¼Œå†ä¹Ÿä¸ç”¨ä¸ºäº†çœ‹ä¸€ä¸ªå‡½æ•°è€Œæ»šåŠ¨300è¡Œä»£ç æˆ–è€…è¦ç”¨æœç´¢æ‰èƒ½æ‰¾åˆ°äº†ã€‚
> è¿™3ä¸ªæ–‡ä»¶ç›®å‰éƒ½åªæœ‰40-50è¡Œã€‚

åŸæ¥643è¡Œçš„æ–‡ä»¶ï¼Œç°åœ¨æ˜¯490è¡Œï¼Œä¼˜åŒ–æ‰äº†150è¡Œï¼ˆ23%ï¼‰çš„ä»£ç ã€‚ä½¿ä»£ç æœ‰äº†æ›´å¥½çš„å°è£…ï¼Œæ”¹å–„äº†é˜…è¯»/ç»´æŠ¤éš¾åº¦ã€‚


