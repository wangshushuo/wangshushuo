---
title: 企业微信机器人
url: /企业微信机器人.html
date: 2021-08-04T18:25:15+08:00
description: 摘要，显示在meta的description中
categories:
- 分类
tags:
- 显示在底部
keywords:
- aa
---

## 机器人
> hover机器人，卡片右上角的编辑按钮可以看到机器人配置说明。
gitlab的webhook可以推送mr消息。企业微信的机器人可以接受消息，但是两边的消息格式不同，需要有一个中间人进行翻译。

gitlab的消息中有
```
  "user": {
    "id": 114,
    "name": "shushuo.wang",
    "username": "shushuo.wang",
    "avatar_url": "http://gitlab.xxxx.com/uploads/-/system/user/avatar/114/avatar.png",
    "email": "shushuo.wang@77hub.com"
  }
```
可以分辨出是谁发起的mr。

将机器人（小组群）和小组人员做一个映射，如果发mr是张三，就将消息发给张三小组群的机器人。

发给机器人的消息格式（https://work.weixin.qq.com/api/doc/90000/90136/91770）

文字消息现在就够用：
```
{
    "msgtype": "text",
    "text": {
        "content": "广州今日天气：29度，大部分多云，降雨概率：60%",
        "mentioned_list":["wangqing","@all"],
        "mentioned_mobile_list":["13800001111","@all"]
    }
}
```
将mr的url（object_attributes.url）放到消息提中，提及中@all

----

go程序设计

做一个接口，作为gitlab的webhook地址。（/gitlab/message/mr)
接收到的数据进行解析，user和object_attributes。
查到user对应的小组机器人url（需要一个表，或者管理页面）
向url发起一个请求，将消息发给机器人url

